{
  "serviceKey": "rm_playground_database",
  "actionName": "get-resto-inspect-inspection-recent",
  "displayName": "Get Recent Inspections",
  "description": "Fetches recent inspections for a specific inspector, ordered by last update time. Returns inspection details including photo/video counts and relative time since last update.",
  "language": "javascript",
  "functionCode": "async function executeAction(payload, context) {\n  const { PrismaClient } = require('@prisma/client');\n  const prisma = new PrismaClient({\n    datasources: {\n      db: {\n        url: context.systemParams.PLAYGROUND_DATABASE_URL\n      }\n    }\n  });\n\n  try {\n    const inspectorId = payload.inspectorId;\n    const limit = parseInt(payload.limit || '5');\n    \n    if (!inspectorId) {\n      return { success: false, error: 'inspectorId is required' };\n    }\n\n    const inspections = await prisma.inspection.findMany({\n      where: {\n        mondayInspectorId: inspectorId,\n      },\n      orderBy: {\n        updatedAt: 'desc',\n      },\n      take: limit,\n      select: {\n        id: true,\n        address: true,\n        streetAddress: true,\n        city: true,\n        zipCode: true,\n        photoUrls: true,\n        videoUrls: true,\n        status: true,\n        currentStep: true,\n        isUrgent: true,\n        createdAt: true,\n        updatedAt: true,\n      },\n    });\n\n    const processedInspections = inspections.map(inspection => {\n      let photoCount = 0;\n      let videoCount = 0;\n\n      inspection.photoUrls.forEach(entry => {\n        try {\n          JSON.parse(entry);\n          photoCount++;\n        } catch {\n          if (entry.trim()) photoCount++;\n        }\n      });\n\n      inspection.videoUrls.forEach(entry => {\n        try {\n          JSON.parse(entry);\n          videoCount++;\n        } catch {\n          if (entry.trim()) videoCount++;\n        }\n      });\n\n      const now = new Date();\n      const updatedAt = new Date(inspection.updatedAt);\n      const diffMs = now.getTime() - updatedAt.getTime();\n      const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\n      const diffMinutes = Math.floor(diffMs / (1000 * 60));\n\n      let timeAgo = '';\n      if (diffHours >= 24) {\n        const diffDays = Math.floor(diffHours / 24);\n        timeAgo = `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;\n      } else if (diffHours >= 1) {\n        timeAgo = `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;\n      } else if (diffMinutes >= 1) {\n        timeAgo = `${diffMinutes} minute${diffMinutes > 1 ? 's' : ''} ago`;\n      } else {\n        timeAgo = 'Just now';\n      }\n\n      return {\n        ...inspection,\n        photoCount,\n        videoCount,\n        timeAgo,\n      };\n    });\n\n    await prisma.$disconnect();\n    return { success: true, data: { inspections: processedInspections } };\n  } catch (error) {\n    await prisma.$disconnect();\n    context.logger.error('Get recent inspections error:', error);\n    return { success: false, error: 'Failed to get recent inspections' };\n  }\n}",
  "httpMethod": "GET",
  "systemParameters": [
    "PLAYGROUND_DATABASE_URL"
  ],
  "payloadSchema": {
    "type": "object",
    "properties": {
      "inspectorId": {
        "type": "string",
        "description": "The ID of the inspector whose recent inspections to fetch"
      },
      "limit": {
        "type": "string",
        "description": "Maximum number of inspections to return (default: 5)"
      }
    },
    "required": [
      "inspectorId"
    ]
  },
  "responseSchema": {
    "type": "object",
    "properties": {
      "success": {
        "type": "boolean"
      },
      "data": {
        "type": "object",
        "properties": {
          "inspections": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                },
                "address": {
                  "type": "string"
                },
                "streetAddress": {
                  "type": "string"
                },
                "city": {
                  "type": "string"
                },
                "zipCode": {
                  "type": "string"
                },
                "photoUrls": {
                  "type": "array"
                },
                "videoUrls": {
                  "type": "array"
                },
                "status": {
                  "type": "string"
                },
                "currentStep": {
                  "type": "string"
                },
                "isUrgent": {
                  "type": "boolean"
                },
                "createdAt": {
                  "type": "string"
                },
                "updatedAt": {
                  "type": "string"
                },
                "photoCount": {
                  "type": "number"
                },
                "videoCount": {
                  "type": "number"
                },
                "timeAgo": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "error": {
        "type": "string"
      }
    }
  }
}