{
  "method": "GET",
  "url": "/api/inspection/stats?inspectorId=${user.id}",
  "functionName": "GET",
  "functionFile": "/Users/kurttimajo/dev/restoremasters/resto-inspect/src/app/api/inspection/stats/route.ts",
  "functionCode": "export async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const inspectorId = searchParams.get('inspectorId')\n    \n    if (!inspectorId) {\n      return NextResponse.json({ error: 'inspectorId is required' }, { status: 400 })\n    }\n\n    // Get today's date range\n    const today = new Date()\n    const startOfToday = new Date(today.getFullYear(), today.getMonth(), today.getDate())\n    const endOfToday = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1)\n\n    // Get this week's date range (Monday to Sunday)\n    const startOfWeek = new Date(today)\n    const dayOfWeek = today.getDay()\n    const daysToMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1 // Sunday = 0, so we need 6 days back\n    startOfWeek.setDate(today.getDate() - daysToMonday)\n    startOfWeek.setHours(0, 0, 0, 0)\n\n    const endOfWeek = new Date(startOfWeek)\n    endOfWeek.setDate(startOfWeek.getDate() + 7)\n\n    // Count inspections for today (all statuses, created or updated today)\n    const inspectionsToday = await prisma.inspection.count({\n      where: {\n        mondayInspectorId: inspectorId,\n        OR: [\n          {\n            createdAt: {\n              gte: startOfToday,\n              lt: endOfToday,\n            },\n          },\n          {\n            updatedAt: {\n              gte: startOfToday,\n              lt: endOfToday,\n            },\n          },\n        ],\n      },\n    })\n\n    // Count inspections for this week (all statuses, created or updated this week)\n    const inspectionsThisWeek = await prisma.inspection.count({\n      where: {\n        mondayInspectorId: inspectorId,\n        OR: [\n          {\n            createdAt: {\n              gte: startOfWeek,\n              lt: endOfWeek,\n            },\n          },\n          {\n            updatedAt: {\n              gte: startOfWeek,\n              lt: endOfWeek,\n            },\n          },\n        ],\n      },\n    })\n\n    // Get completed inspections for today and this week for additional stats\n    const completedToday = await prisma.inspection.count({\n      where: {\n        mondayInspectorId: inspectorId,\n        status: 'COMPLETED',\n        updatedAt: {\n          gte: startOfToday,\n          lt: endOfToday,\n        },\n      },\n    })\n\n    const completedThisWeek = await prisma.inspection.count({\n      where: {\n        mondayInspectorId: inspectorId,\n        status: 'COMPLETED',\n        updatedAt: {\n          gte: startOfWeek,\n          lt: endOfWeek,\n        },\n      },\n    })\n\n    // Debug: Get all inspections for this inspector to see what we have\n    const allInspections = await prisma.inspection.findMany({\n      where: {\n        mondayInspectorId: inspectorId,\n      },\n      select: {\n        id: true,\n        status: true,\n        createdAt: true,\n        updatedAt: true,\n        address: true,\n      },\n      orderBy: {\n        updatedAt: 'desc',\n      },\n    })\n\n    return NextResponse.json({\n      inspectionsToday,\n      inspectionsThisWeek,\n      completedToday,\n      completedThisWeek,\n      dateRanges: {\n        today: { start: startOfToday, end: endOfToday },\n        thisWeek: { start: startOfWeek, end: endOfWeek },\n      },\n      debug: {\n        allInspections,\n        inspectorId,\n      },\n    })\n  } catch (error) {\n    console.error('Get inspection stats error:', error)\n    return NextResponse.json(\n      { error: 'Failed to get inspection statistics' },\n      { status: 500 }\n    )\n  }\n}",
  "functionResolutionConfidence": "high"
}