{
  "method": "POST",
  "url": "/api/inspection/add-media",
  "functionName": "POST",
  "functionFile": "/Users/kurttimajo/dev/restoremasters/resto-inspect/src/app/api/inspection/add-media/route.ts",
  "functionCode": "export async function POST(request: NextRequest) {\n  try {\n    const { inspectionId, mediaUrl, mediaKey, mediaType, tags } = await request.json()\n\n    if (!inspectionId || !mediaUrl || !mediaType) {\n      return NextResponse.json(\n        { error: 'Missing required fields: inspectionId, mediaUrl, mediaType' },\n        { status: 400 }\n      )\n    }\n\n    const inspection = await prisma.inspection.findUnique({\n      where: { id: inspectionId },\n      select: { photoUrls: true, videoUrls: true }\n    })\n\n    if (!inspection) {\n      return NextResponse.json(\n        { error: 'Inspection not found' },\n        { status: 404 }\n      )\n    }\n\n    const entry = {\n      url: mediaUrl,\n      key: mediaKey || null,\n      tags: Array.isArray(tags) ? tags : [],\n      addedAt: new Date().toISOString()\n    }\n\n    const data: any = {}\n    if (mediaType === 'photo') {\n      data.photoUrls = [...(inspection.photoUrls || []), JSON.stringify(entry)]\n    } else if (mediaType === 'video') {\n      data.videoUrls = [...(inspection.videoUrls || []), JSON.stringify(entry)]\n    } else {\n      return NextResponse.json({ error: 'Invalid mediaType. Must be \"photo\" or \"video\"' }, { status: 400 })\n    }\n\n    const updated = await prisma.inspection.update({ where: { id: inspectionId }, data })\n    return NextResponse.json({ success: true, inspection: updated })\n  } catch (error) {\n    console.error('Add media error:', error)\n    return NextResponse.json(\n      { error: 'Failed to add media to inspection' },\n      { status: 500 }\n    )\n  }\n}",
  "functionResolutionConfidence": "high"
}