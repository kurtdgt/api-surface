{
  "method": "GET",
  "url": "/api/inspection/submissions?inspectorId=${user.id}",
  "functionName": "GET",
  "functionFile": "/Users/kurttimajo/dev/restoremasters/resto-inspect/src/app/api/inspection/submissions/route.ts",
  "functionCode": "export async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const inspectorId = searchParams.get('inspectorId')\n    const inspectorIds = searchParams.getAll('inspectorIds')\n    \n    // Build where clause for inspector filtering\n    const whereClause: any = {}\n    if (inspectorIds.length > 0) {\n      // If multiple inspector IDs are provided, use those\n      whereClause.mondayInspectorId = { in: inspectorIds }\n    } else if (inspectorId) {\n      // If single inspector ID is provided, use that\n      whereClause.mondayInspectorId = inspectorId\n    }\n    // If neither is provided, whereClause remains empty (fetches all inspections)\n\n    // Fetch all inspections ordered by updatedAt\n    const inspections = await prisma.inspection.findMany({\n      where: whereClause,\n      orderBy: {\n        updatedAt: 'desc',\n      },\n      select: {\n        id: true,\n        address: true,\n        streetAddress: true,\n        city: true,\n        zipCode: true,\n        photoUrls: true,\n        videoUrls: true,\n        status: true,\n        currentStep: true,\n        isUrgent: true,\n        createdAt: true,\n        updatedAt: true,\n        mondayInspectorId: true,\n      },\n    })\n\n    // Process inspections to add photo/video counts and relative time\n    const processedInspections = inspections.map(inspection => {\n      // Count photos and videos from JSON strings or plain URLs\n      let photoCount = 0\n      let videoCount = 0\n\n      inspection.photoUrls.forEach(entry => {\n        try {\n          JSON.parse(entry) // If it's a JSON string, it's valid\n          photoCount++\n        } catch {\n          if (entry.trim()) photoCount++ // If it's a plain URL and not empty\n        }\n      })\n\n      inspection.videoUrls.forEach(entry => {\n        try {\n          JSON.parse(entry) // If it's a JSON string, it's valid\n          videoCount++\n        } catch {\n          if (entry.trim()) videoCount++ // If it's a plain URL and not empty\n        }\n      })\n\n      // Calculate relative time\n      const now = new Date()\n      const updatedAt = new Date(inspection.updatedAt)\n      const diffMs = now.getTime() - updatedAt.getTime()\n      const diffHours = Math.floor(diffMs / (1000 * 60 * 60))\n      const diffMinutes = Math.floor(diffMs / (1000 * 60))\n\n      let timeAgo = ''\n      if (diffHours >= 24) {\n        const diffDays = Math.floor(diffHours / 24)\n        timeAgo = `${diffDays} day${diffDays > 1 ? 's' : ''} ago`\n      } else if (diffHours >= 1) {\n        timeAgo = `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`\n      } else if (diffMinutes >= 1) {\n        timeAgo = `${diffMinutes} minute${diffMinutes > 1 ? 's' : ''} ago`\n      } else {\n        timeAgo = 'Just now'\n      }\n\n      // Format date for display\n      const date = new Date(inspection.updatedAt).toLocaleDateString('en-US', {\n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit'\n      })\n\n      return {\n        ...inspection,\n        photoCount,\n        videoCount,\n        timeAgo,\n        date,\n      }\n    })\n\n    return NextResponse.json({\n      submissions: processedInspections,\n    })\n  } catch (error) {\n    console.error('Get submissions error:', error)\n    return NextResponse.json(\n      { error: 'Failed to get submissions' },\n      { status: 500 }\n    )\n  }\n}",
  "functionResolutionConfidence": "high"
}