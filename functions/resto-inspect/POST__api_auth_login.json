{
  "method": "POST",
  "url": "/api/auth/login",
  "functionName": "POST",
  "functionFile": "/Users/kurttimajo/dev/restoremasters/resto-inspect/src/app/api/auth/login/route.ts",
  "functionCode": "export async function POST(request: NextRequest) {\n  const startTime = Date.now();\n  let email = '';\n  try {\n    const body: LoginForm = await request.json();\n    const { email: userEmail, password } = body;\n    email = userEmail;\n\n    // Validate input\n    if (!email || !password) {\n      return NextResponse.json(\n        { error: 'Email and password are required' },\n        { status: 400 }\n      );\n    }\n\n    // Find user by email in Monday users database\n    const mondayUsers = await mondayUserOperations.findByEmail(email.toLowerCase());\n    \n    if (!mondayUsers || mondayUsers.length === 0) {\n      return NextResponse.json(\n        { error: 'Invalid email or password' },\n        { status: 401 }\n      );\n    }\n\n    const mondayUser = mondayUsers[0];\n\n    // Check password (assuming password is stored as plain text for now)\n    if (mondayUser.password !== password) {\n      return NextResponse.json(\n        { error: 'Invalid email or password' },\n        { status: 401 }\n      );\n    }\n\n    // Revoke all existing refresh tokens for this Monday user\n    await revokeAllRefreshTokens(mondayUser.id);\n    \n    // Generate new tokens using Monday user data\n    const tokens = await generateAuthTokens({\n      id: mondayUser.id,\n      email: mondayUser.email,\n      name: `${mondayUser.first_name} ${mondayUser.last_name}`,\n      role: mondayUser.role,\n      avatar: mondayUser.profile_photo_url || null,\n    });\n\n    const responseTime = Date.now() - startTime;\n    console.log(`✅ Login successful for ${email} in ${responseTime}ms`);\n    \n    return NextResponse.json({\n      success: true,\n      message: 'Login successful',\n      data: {\n        user: {\n          id: mondayUser.id,\n          email: mondayUser.email,\n          name: `${mondayUser.first_name} ${mondayUser.last_name}`,\n          role: mondayUser.role,\n          avatar: mondayUser.profile_photo_url || null,\n        },\n        accessToken: tokens.accessToken,\n        refreshToken: tokens.refreshToken,\n        expiresIn: tokens.expiresIn,\n      },\n    });\n  } catch (error) {\n    const responseTime = Date.now() - startTime;\n    console.error(`❌ Login error for ${email} after ${responseTime}ms:`, error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}",
  "functionResolutionConfidence": "high"
}