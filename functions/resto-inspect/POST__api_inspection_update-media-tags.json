{
  "method": "POST",
  "url": "/api/inspection/update-media-tags",
  "functionName": "POST",
  "functionFile": "/Users/kurttimajo/dev/restoremasters/resto-inspect/src/app/api/inspection/update-media-tags/route.ts",
  "functionCode": "export async function POST(request: NextRequest) {\n  try {\n    const { inspectionId, mediaUrl, mediaType, tags } = await request.json()\n\n    if (!inspectionId || !mediaUrl || !mediaType) {\n      return NextResponse.json({ error: 'Missing required fields' }, { status: 400 })\n    }\n\n    // Find the inspection\n    const inspection = await prisma.inspection.findUnique({\n      where: { id: inspectionId }\n    })\n\n    if (!inspection) {\n      return NextResponse.json({ error: 'Inspection not found' }, { status: 404 })\n    }\n\n    // Update the media entry with tags\n    const mediaEntry = JSON.stringify({\n      url: mediaUrl,\n      key: mediaUrl, // Assuming the key is the same as URL for now\n      tags: tags || [],\n      timestamp: new Date().toISOString()\n    })\n\n    let updated = false\n\n    // Update photoUrls if it's a photo\n    if (mediaType === 'photo') {\n      const photoUrls = inspection.photoUrls || []\n      const updatedPhotoUrls = photoUrls.map(url => {\n        try {\n          const parsed = JSON.parse(url)\n          if (parsed.url === mediaUrl) {\n            updated = true\n            return mediaEntry\n          }\n        } catch {\n          if (url === mediaUrl) {\n            updated = true\n            return mediaEntry\n          }\n        }\n        return url\n      })\n\n      if (updated) {\n        await prisma.inspection.update({\n          where: { id: inspectionId },\n          data: { photoUrls: updatedPhotoUrls }\n        })\n      }\n    }\n\n    // Update videoUrls if it's a video\n    if (mediaType === 'video') {\n      const videoUrls = inspection.videoUrls || []\n      const updatedVideoUrls = videoUrls.map(url => {\n        try {\n          const parsed = JSON.parse(url)\n          if (parsed.url === mediaUrl) {\n            updated = true\n            return mediaEntry\n          }\n        } catch {\n          if (url === mediaUrl) {\n            updated = true\n            return mediaEntry\n          }\n        }\n        return url\n      })\n\n      if (updated) {\n        await prisma.inspection.update({\n          where: { id: inspectionId },\n          data: { videoUrls: updatedVideoUrls }\n        })\n      }\n    }\n\n    if (!updated) {\n      return NextResponse.json({ error: 'Media not found in inspection' }, { status: 404 })\n    }\n\n    return NextResponse.json({ success: true, tags })\n  } catch (error) {\n    console.error('Update media tags error:', error)\n    return NextResponse.json(\n      { error: 'Failed to update media tags' },\n      { status: 500 }\n    )\n  }\n}",
  "functionResolutionConfidence": "high"
}